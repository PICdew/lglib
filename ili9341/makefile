#
# Makefile
#
# Copyright 2014 Fernando Rodriguez (support@fernansoft.com). 
# All rights reserved
#

#
# Note: This makefile has only been tested with
# GNU Make v3.81 on Windows. You may need to modify
# the "toolchain" section bellow (even if you're running
# it on Windows as your tools path may be different)
#


#
# toolchain
#
CC="C:\Program Files (x86)\Microchip\xc16\v1.21\bin\xc16-gcc.exe" 
AS="C:\Program Files (x86)\Microchip\xc16\v1.21\bin\xc16-gcc.exe"
AR="C:\Program Files (x86)\Microchip\xc16\v1.21\bin\xc16-ar.exe"
RM=del /Q
HAL=../fat32lib/dspic_hal

OPT=-O3

#
# target flags
#
p33f: CFLAGS=-omf=coff $(OPT) -I"$(HAL)" -I"../lglib" -x c -Wall -mlarge-code -mlarge-data -fno-schedule-insns -fno-schedule-insns2 -mno-eds-warn -mcpu=33FJ256GP710A
p33f: ASFLAGS=-omf=-coff -mcpu=33FJ256GP710A -c -Wa
p33e: CFLAGS=-omf=coff $(OPT) -I"$(HAL)" -I"../lglib" -x c -Wall -mlarge-code -mlarge-data -fno-schedule-insns -fno-schedule-insns2 -mno-eds-warn -mcpu=33EP512GP502
p33e: ASFLAGS=-omf=coff -mcpu=33EP512GP502 -c -Wa
ARFLAGS=-omf=coff r
#
# target libraries
#
LIBRARY_P33E=ili9341_p33e.a
LIBRARY_P33F=ili9341_p33f.a

#
# sources
#
SOURCES=ili9341.c
OBJECTS=$(SOURCES:.c=.o)

#
# make
#
all: p33f
p33f: clean $(SOURCES) $(LIBRARY_P33F)
p33e: clean $(SOURCES) $(LIBRARY_P33E)

$(LIBRARY_P33E): $(OBJECTS)
	$(RM) $(LIBRARY_P33E)
	$(AR) $(ARFLAGS) $@ $(OBJECTS)
	
$(LIBRARY_P33F): $(OBJECTS)
	$(RM) $(LIBRARY_P33F)
	$(AR) $(ARFLAGS) $@ $(OBJECTS)
	
.cpp.o:
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	$(RM) $(OBJECTS)
